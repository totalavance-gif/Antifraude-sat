<!DOCTYPE html>

<html lang="es">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Antifraude SAT v3.0</title>


<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/jsqr/dist/jsQR.js"></script>


<style>

:root{

Â --bg:#f4f6f8; --card:#fff; --text:#1f2937;

Â --green:#16a34a; --yellow:#f59e0b; --red:#dc2626;

}

body{margin:0;font-family:system-ui;background:var(--bg);color:var(--text)}

.container{max-width:1000px;margin:auto;padding:24px}

.card{background:var(--card);border-radius:14px;padding:20px;margin-bottom:20px;

box-shadow:0 6px 18px rgba(0,0,0,.06)}

.ok{border-left:6px solid var(--green)}

.warn{border-left:6px solid var(--yellow)}

.bad{border-left:6px solid var(--red)}

input{width:100%;padding:12px;border:1px dashed #cbd5e1;border-radius:10px}

ul{padding-left:18px}

.tag{font-size:.75rem;padding:2px 8px;border-radius:10px;margin-left:6px}

.okTag{background:#dcfce7;color:#166534}

.warnTag{background:#fef3c7;color:#92400e}

.badTag{background:#fee2e2;color:#991b1b}

footer{text-align:center;color:#6b7280;font-size:.85rem;margin-top:40px}

</style>

</head>


<body>

<div class="container">


<h1>ğŸ” Antifraude SAT v3.0</h1>

<p>Escaneo completo de constancias fiscales (PDF).Â Â 

Detecta documentos clonados incluso con QR legÃ­timos.</p>


<div class="card">

Â Â <h3>ğŸ“„ Subir constancia SAT (PDF)</h3>

Â Â <input type="file" accept="application/pdf" id="pdfInput">

</div>


<div id="output"></div>


<footer>

AnÃ¡lisis local Â· No se suben ni guardanÂ  archivos 5647385519 Â· v3.0

</footer>

</div>


<script>

pdfjsLib.GlobalWorkerOptions.workerSrc =

Â "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";


/* =============================

Â Â Â MODELO DE PESOS v3

============================= */

const WEIGHTS = {

Â Â MIXED_QR: 10,

Â Â ASALARIADO1: 9,

Â Â DOUBLE_EMISSION: 8,

Â Â PLACEHOLDERS: 8,

Â Â BAD_ORDER: 7,

Â Â RFC_INCONSISTENT: 7,

Â Â TEXT_CUT: 3,

Â Â DUP_HEADERS: 3,

Â Â IDCIF_MISSING: 3,

Â Â MULTI_DOMAINS: 4,

Â Â ALL_GOB_QR: -3,

Â Â QR_INTERNO: -2,

Â Â CLEAN_TEXT: -4,

Â Â GOOD_ORDER: -4,

Â Â COHERENT_DATES: -3

};


document.getElementById("pdfInput").addEventListener("change", analyzePDF);


/* =============================

Â Â Â MULTI QR SCAN

============================= */

function scanMultipleQR(canvas, page) {

Â Â const ctx = canvas.getContext("2d");

Â Â const regions = [

Â Â Â Â {y:0,h:canvas.height/3},

Â Â Â Â {y:canvas.height/3,h:canvas.height/3},

Â Â Â Â {y:(canvas.height/3)*2,h:canvas.height/3}

Â Â ];

Â Â const found=[];

Â Â regions.forEach((r,i)=>{

Â Â Â Â const img=ctx.getImageData(0,r.y,canvas.width,r.h);

Â Â Â Â const qr=jsQR(img.data,img.width,img.height);

Â Â Â Â if(qr){

Â Â Â Â Â Â let domain="invÃ¡lido",isGob=false,type="sospechoso";

Â Â Â Â Â Â try{

Â Â Â Â Â Â Â Â const url=new URL(qr.data);

Â Â Â Â Â Â Â Â domain=url.hostname;

Â Â Â Â Â Â Â Â isGob=domain.endsWith(".gob.mx");

Â Â Â Â Â Â Â Â if(isGob){

Â Â Â Â Â Â Â Â Â Â type=/siat|validador/i.test(qr.data)?"validaciÃ³n":"interno";

Â Â Â Â Â Â Â Â }

Â Â Â Â Â Â }catch{}

Â Â Â Â Â Â found.push({page,region:i+1,domain,isGob,type});

Â Â Â Â }

Â Â });

Â Â return found;

}


/* =============================

Â Â Â MAIN

============================= */

async function analyzePDF(e){

Â Â const out=document.getElementById("output");

Â Â out.innerHTML="";

Â Â const file=e.target.files[0];

Â Â if(!file)return;


Â Â const pdf=await pdfjsLib.getDocument(await file.arrayBuffer()).promise;


Â Â let text="",qrs=[],features=[],score=0;


Â Â for(let i=1;i<=pdf.numPages;i++){

Â Â Â Â const page=await pdf.getPage(i);


Â Â Â Â const tc=await page.getTextContent();

Â Â Â Â const pageText=tc.items.map(t=>t.str).join(" ");

Â Â Â Â text+=" "+pageText;


Â Â Â Â const vp=page.getViewport({scale:2});

Â Â Â Â const canvas=document.createElement("canvas");

Â Â Â Â canvas.width=vp.width;canvas.height=vp.height;

Â Â Â Â await page.render({canvasContext:canvas.getContext("2d"),viewport:vp}).promise;


Â Â Â Â qrs.push(...scanMultipleQR(canvas,i));

Â Â }


Â Â /* ========= FEATURES ========= */

Â Â const rfcs=[...new Set(text.match(/[A-Z]{4}\d{6}[A-Z0-9]{3}/g)||[])];

Â Â if(rfcs.length!==1){score+=WEIGHTS.RFC_INCONSISTENT;features.push("RFC inconsistente");}


Â Â if(/Asalariado1/.test(text)){score+=WEIGHTS.ASALARIADO1;features.push("Error 'Asalariado1'");}


Â Â if(!/idCIF:\s*\d+/.test(text)){score+=WEIGHTS.IDCIF_MISSING;features.push("idCIF ausente");}


Â Â if(/RFC:\s*CURP:/i.test(text)){score+=WEIGHTS.PLACEHOLDERS;features.push("Placeholders vacÃ­os");}


Â Â const dates=text.match(/\d{2}\/\d{2}\/\d{4}/g)||[];

Â Â if(new Set(dates).size>1){score+=WEIGHTS.DOUBLE_EMISSION;features.push("MÃºltiples fechas de emisiÃ³n");}

Â Â else score+=WEIGHTS.COHERENT_DATES;


Â Â /* ========= QR FEATURES ========= */

Â Â const gob=qrs.filter(q=>q.isGob);

Â Â const nonGob=qrs.filter(q=>!q.isGob);

Â Â const domains=[...new Set(qrs.map(q=>q.domain))];


Â Â if(gob.length&&nonGob.length){score+=WEIGHTS.MIXED_QR;features.push("Mezcla QR oficial/no oficial");}

Â Â if(domains.length>1&&nonGob.length){score+=WEIGHTS.MULTI_DOMAINS;features.push("Dominios QR distintos");}

Â Â if(nonGob.length===0&&gob.length>0){score+=WEIGHTS.ALL_GOB_QR;}


Â Â qrs.forEach(q=>{

Â Â Â Â if(q.type==="interno")score+=WEIGHTS.QR_INTERNO;

Â Â });


Â Â /* ========= CLASIFICACIÃ“N ========= */

Â Â let level="ok",result="ğŸŸ¢ Documento ORIGINAL del SAT";

Â Â if(score>=7){level="bad";result="ğŸ”´ POSIBLE CLON";}

Â Â else if(score>=3){level="warn";result="ğŸŸ¡ Documento SOSPECHOSO";}


Â Â /* ========= RENDER ========= */

Â Â out.innerHTML=`

Â Â <div class="card ${level}">

Â Â Â Â <h3>${result}</h3>

Â Â Â Â <p><b>Score final:</b> ${score}</p>

Â Â Â Â <ul>${features.map(f=>`<li>${f}</li>`).join("")}</ul>

Â Â </div>


Â Â <div class="card">

Â Â Â Â <h4>ğŸ” AnÃ¡lisis de QRs</h4>

Â Â Â Â <ul>

Â Â Â Â Â Â ${qrs.map(q=>`

Â Â Â Â Â Â Â Â <li>

Â Â Â Â Â Â Â Â Â Â PÃ¡gina ${q.page} â†’ ${q.domain}

Â Â Â Â Â Â Â Â Â Â <span class="tag ${q.type==="validaciÃ³n"?"okTag":q.type==="interno"?"warnTag":"badTag"}">

Â Â Â Â Â Â Â Â Â Â Â Â ${q.type}

Â Â Â Â Â Â Â Â Â Â </span>

Â Â Â Â Â Â Â Â </li>

Â Â Â Â Â Â `).join("")}

Â Â Â Â </ul>

Â Â Â Â <small>Nota: QRs internos del SAT pueden no devolver datos pÃºblicos.</small>

Â Â </div>`;

}

</script>

</body>

</html>

